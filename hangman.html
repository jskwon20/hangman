<!DOCTYPE html>
<html>
<head>
    <title>HANG MAN</title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            line-height: 1.6;
        }
        
        .game-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .hangman-container {
            width: 100%;
            max-width: 300px;
            height: 300px;
            margin: 0 auto 30px;
            text-align: center;
        }
        
        .hangman {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .game-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .word-display {
            font-size: 2em;
            letter-spacing: 0.5em;
            margin: 20px 0;
            font-family: monospace;
            min-height: 1.5em;
        }
        
        .hint {
            color: #666;
            font-style: italic;
            margin: 10px 0;
            min-height: 1.5em;
        }
        
        .attempts {
            font-weight: bold;
            margin: 10px 0;
        }
        
        .input-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        #guess-input {
            padding: 10px;
            width: 50px;
            text-align: center;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .hint-container {
            text-align: center;
            margin: 20px 0;
        }
        
        #hint-button {
            background-color: #2196F3;
        }
        
        #hint-button:hover {
            background-color: #0b7dda;
        }
        
        .message {
            text-align: center;
            min-height: 1.5em;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            color: #2e7d32;
        }
        
        .error {
            color: #d32f2f;
        }
        
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        
        #restart-button {
            background-color: #ff9800;
        }
        
        #restart-button:hover {
            background-color: #e68a00;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>행맨 게임</h1>
        <div class="hangman-container">
            <svg id="hangman-svg" width="100%" height="100%" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                <!-- Gallows -->
                <rect x="40" y="40" width="180" height="10" fill="#5D4037" rx="2"/>
                <rect x="50" y="40" width="10" height="250" fill="#5D4037" rx="2"/>
                <rect x="50" y="280" width="150" height="10" fill="#5D4037" rx="2"/>
                <rect x="180" y="40" width="10" height="40" fill="#5D4037" rx="2"/>
                
                <!-- Rope -->
                <rect x="185" y="80" width="4" height="30" fill="#8D6E63"/>
                
                <!-- Hangman Parts (initially hidden) -->
                <g id="hangman-parts">
                    <!-- Head (얼굴 전체) -->
                    <circle id="head" cx="187" cy="115" r="25" fill="none" stroke="#333" stroke-width="3" style="display: none;"/>
                    <!-- Face features (displayed with head) -->
                    <circle id="left-eye" cx="175" cy="110" r="3" fill="#333" style="display: none;"/>
                    <circle id="right-eye" cx="200" cy="110" r="3" fill="#333" style="display: none;"/>
                    <path id="mouth" d="M175 130 Q187 140 200 130" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" style="display: none;"/>
                    
                    <!-- Body (몸통) -->
                    <line id="body" x1="187" y1="140" x2="187" y2="220" stroke="#333" stroke-width="4" stroke-linecap="round" style="display: none;"/>
                    
                    <!-- Arms (팔) - 더 길고 자연스럽게 -->
                    <line id="left-arm" x1="187" y1="165" x2="137" y2="215" stroke="#333" stroke-width="4" stroke-linecap="round" style="display: none;"/>
                    <line id="right-arm" x1="187" y1="165" x2="237" y2="215" stroke="#333" stroke-width="4" stroke-linecap="round" style="display: none;"/>
                    
                    <!-- Legs (다리) - 더 길고 사선으로 -->
                    <line id="left-leg" x1="187" y1="220" x2="157" y2="290" stroke="#333" stroke-width="4" stroke-linecap="round" style="display: none;"/>
                    <line id="right-leg" x1="187" y1="220" x2="217" y2="290" stroke="#333" stroke-width="4" stroke-linecap="round" style="display: none;"/>
                </g>
            </svg>
        </div>
        
        <div class="game-info">
            <div id="word-display" class="word-display"></div>
            <div id="hint-display" class="hint"></div>
            <div id="attempts" class="attempts"></div>
            <div id="guessed-letters" class="guessed-letters"></div>
        </div>
        
        <div class="input-container">
            <input type="text" id="guess-input" maxlength="1" placeholder="글자 입력" autofocus>
            <button id="guess-button">입력</button>
        </div>
        
        <div class="hint-container">
            <button id="hint-button">힌트 보기</button>
            <button id="restart-button">다시 시작</button>
        </div>
        
        <div id="message" class="message"></div>
    </div>

    <script>
        // DOM Elements
        const guessInput = document.getElementById('guess-input');
        const guessButton = document.getElementById('guess-button');
        const hintButton = document.getElementById('hint-button');
        const restartButton = document.getElementById('restart-button');
        const guessedLettersDisplay = document.getElementById('guessed-letters');
        const wordDisplay = document.getElementById('word-display');
        const hintDisplay = document.getElementById('hint-display');
        const attemptsDisplay = document.getElementById('attempts');
        const messageDisplay = document.getElementById('message');
        const hangmanParts = ['head', 'body', 'left-arm', 'right-arm', 'left-leg', 'right-leg'];
        const faceFeatures = ['left-eye', 'right-eye', 'mouth'];

        let gameOver = false;

        // --- UI Update Functions ---

        function updateWordDisplay(word) {
            wordDisplay.textContent = word.join(' ');
        }

        function updateAttempts(attempts) {
            attemptsDisplay.textContent = `남은 시도 횟수: ${attempts}`;
        }
        
        function updateGuessedLetters(letters) {
            guessedLettersDisplay.textContent = `추측한 글자: ${letters.join(' ')}`;
        }

        function showMessage(msg, isError = false) {
            messageDisplay.textContent = msg;
            messageDisplay.className = 'message ' + (isError ? 'error' : 'success');
        }

        function resetHangman() {
            const allParts = [...hangmanParts, ...faceFeatures];
            allParts.forEach(partId => {
                const partElement = document.getElementById(partId);
                if (partElement) {
                    partElement.style.display = 'none';
                }
            });
             const mouth = document.getElementById('mouth');
            if (mouth) {
                mouth.setAttribute('d', 'M175 130 Q187 140 200 130'); // Normal mouth
            }
        }

        function showHangmanPart(attemptsLeft) {
            const partsToShow = 6 - attemptsLeft;
            for (let i = 0; i < partsToShow; i++) {
                const partId = hangmanParts[i];
                if (partId) {
                    const partElement = document.getElementById(partId);
                    if (partElement) {
                        partElement.style.display = 'block';
                        // Show face with head
                        if (partId === 'head') {
                            faceFeatures.forEach(faceId => {
                                document.getElementById(faceId).style.display = 'block';
                            });
                        }
                    }
                }
            }
        }
        
        function setGameOverUI(isWin, correctWord) {
            gameOver = true;
            guessInput.disabled = true;
            guessButton.disabled = true;
            if (isWin) {
                showMessage('축하합니다! 단어를 맞추셨습니다!', false);
            } else {
                showMessage(`게임 오버! 정답은 '${correctWord}'였습니다.`, true);
                const mouth = document.getElementById('mouth');
                if (mouth) {
                    mouth.setAttribute('d', 'M175 135 Q187 125 200 135'); // Sad mouth
                }
            }
        }

        // --- API Call Functions ---

        async function startNewGame() {
            try {
                const response = await fetch('/api/game/new', { method: 'POST' });
                const data = await response.json();
                
                gameOver = false;
                updateWordDisplay(data.word_display);
                updateAttempts(data.remaining_attempts);
                updateGuessedLetters([]);
                hintDisplay.textContent = '';
                messageDisplay.textContent = '';
                guessInput.disabled = false;
                guessButton.disabled = false;
                hintButton.disabled = false;
                guessInput.value = '';
                guessInput.focus();
                resetHangman();

            } catch (error) {
                showMessage('게임을 시작하는 데 실패했습니다.', true);
                console.error('Error starting new game:', error);
            }
        }

        async function handleGuess() {
            if (gameOver) return;
            
            const letter = guessInput.value.toLowerCase();
            guessInput.value = '';
            guessInput.focus();

            if (!letter || letter.length !== 1 || !letter.match(/[a-z]/i)) {
                showMessage('한 글자 영문자를 입력해주세요.', true);
                return;
            }

            try {
                const response = await fetch('/api/game/guess', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ letter: letter })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || '추측 처리 중 오류 발생');
                }

                const data = await response.json();

                updateWordDisplay(data.word_display);
                updateAttempts(data.remaining_attempts);
                updateGuessedLetters(data.guessed_letters);
                showHangmanPart(data.remaining_attempts);

                if (!data.correct_guess) {
                     showMessage('틀렸습니다!', true);
                } else {
                     showMessage('정답!', false);
                }

                if (data.game_over) {
                    const isWin = !data.word_display.includes('_');
                    setGameOverUI(isWin, data.word);
                }

            } catch (error) {
                showMessage(error.message, true);
                console.error('Error making a guess:', error);
            }
        }

        async function showHint() {
            if (gameOver) return;
            try {
                const response = await fetch('/api/game/hint');
                const data = await response.json();
                hintDisplay.textContent = `💡 힌트: ${data.hint}`;
                hintButton.disabled = true;
            } catch (error) {
                showMessage('힌트를 가져오는 데 실패했습니다.', true);
                console.error('Error fetching hint:', error);
            }
        }

        // --- Event Listeners ---
        window.addEventListener('DOMContentLoaded', () => {
            restartButton.addEventListener('click', startNewGame);
            guessButton.addEventListener('click', handleGuess);
            hintButton.addEventListener('click', showHint);
            
            guessInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleGuess();
                }
            });

            startNewGame(); // Start the first game on page load
        });
    </script>
</body>
</html>
